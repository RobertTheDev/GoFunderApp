// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Charity {
  id               String            @id @default(cuid()) // Unique identifier for the charity.
  createdAt        DateTime          @default(now()) @map("created_at") // Date and time when the charity was created.
  updatedAt        DateTime          @updatedAt @map("updated_at") // Date and time when the charity was last updated.
  category         String // Charity's category.
  charityFollowers CharityFollower[] // List of followers for the charity.
  charityOwners    CharityOwner[] // List of owners for the charity.
  description      String? // Charity's description (optional).
  fundraisers      Fundraiser[] // List of fundraisers owned by the charity.
  logo             String? // URL to the charity's logo image (optional).
  name             String // Charity's name.

  @@map("charities")
}

model CharityFollower {
  id        String   @id @default(cuid()) // Unique identifier for the charity follower.
  createdAt DateTime @default(now()) @map("created_at") // Date and time when the charity follower was created.
  updatedAt DateTime @updatedAt @map("updated_at") // Date and time when the charity follower was last updated.
  charity   Charity  @relation(fields: [charityId], references: [id], onDelete: Cascade) // Reference to the associated charity.
  charityId String // Foreign key to the charity.
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade) // Reference to the associated user.
  userId    String // Foreign key to the user.

  @@unique([charityId, userId]) // Ensure a user can follow a charity only once.
  @@map("charity_followers")
}

model CharityOwner {
  id        String   @id @default(cuid()) // Unique identifier for the charity owner.
  createdAt DateTime @default(now()) @map("created_at") // Date and time when the charity owner was created.
  updatedAt DateTime @updatedAt @map("updated_at") // Date and time when the charity owner was last updated.
  charity   Charity  @relation(fields: [charityId], references: [id], onDelete: Cascade) // Reference to the associated charity.
  charityId String   @map("charity_id") // Foreign key to the charity.
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade) // Reference to the associated user.
  userId    String   @map("user_id") // Foreign key to the user.

  @@unique([charityId, userId]) // Ensure a user can own a charity only once.
  @@map("charity_owners")
}

model Donation {
  id           String      @id @default(cuid()) // Unique identifier for the donation.
  createdAt    DateTime    @default(now()) @map("created_at") // Date and time when the donation was created.
  deletedAt    DateTime?   @map("deleted_at") // Date and time when the donation was deleted.
  updatedAt    DateTime    @updatedAt @map("updated_at") // Date and time when the donation was last updated.
  amount       Int // Amount of the donation.
  annonymous   Boolean     @default(false) // Indicates whether the donation is anonymous.
  currency     String      @default("GBP") // Currency of the donation.
  fundraiser   Fundraiser? @relation(fields: [fundraiserId], references: [id]) // Reference to the associated fundraiser.
  fundraiserId String      @map("fundraiser_id") // Foreign key to the fundraiser.
  message      String? // Additional message associated with the donation.
  user         User?       @relation(fields: [userId], references: [id]) // Reference to the associated user.
  userId       String      @map("user_id") // Foreign key to the user.

  @@map("donations")
}

model Fundraiser {
  id               String            @id @default(cuid()) // Unique identifier for the fundraiser.
  createdAt        DateTime          @default(now()) @map("created_at") // Date and time when the fundraiser was created.
  updatedAt        DateTime          @updatedAt @map("updated_at") // Date and time when the fundraiser was last updated.
  category         String // Category of the fundraiser.
  deadlineDate     DateTime?         @map("deadline_date") // Deadline date and time of the fundraiser.
  defaultCurrency  String            @default("GBP") @map("default_currency") // Default currency for the fundraiser.
  description      String? // Story or description of the fundraiser.
  donations        Donation[] // List of donations for the fundraiser.
  headline         String? // Headline of the fundraiser.
  image            String? // URL to the image associated with the fundraiser.
  savedFundraisers SavedFundraiser[] // List of saved fundraisers.
  target           Int // Fundraising target amount.
  totalDonations   Int               @default(0) @map("total_donations") // Total number of donations received.
  totalRaised      Int               @default(0) @map("total_raised") // Total amount raised.
  charity          Charity?          @relation(fields: [charityId], references: [id]) // Reference to the associated charity.
  charityId        String? // Foreign key to the charity (Optional).
  user             User?             @relation(fields: [userId], references: [id]) // Reference to the associated user.
  userId           String? // Foreign key to the user(Optional).

  @@map("fundraisers")
}

model SavedFundraiser {
  id           String     @id @default(cuid()) // Unique identifier for the saved fundraiser.
  createdAt    DateTime   @default(now()) @map("created_at") // Date and time when the saved fundraiser was created.
  updatedAt    DateTime   @updatedAt @map("updated_at") // Date and time when the saved fundraiser was last updated.
  fundraiser   Fundraiser @relation(fields: [fundraiserId], references: [id], onDelete: Cascade) // Reference to the associated fundraiser.
  fundraiserId String     @map("fundraiser_id") // Foreign key to the fundraiser.
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade) // Reference to the associated user.
  userId       String     @map("user_id") // Foreign key to the user.

  @@unique([fundraiserId, userId]) // Ensure a user can save a fundraiser only once.
  @@map("saved_fundraisers")
}

model User {
  id                    String            @id @default(cuid()) // Unique identifier for the user.
  createdAt             DateTime          @default(now()) @map("created_at") // Date and time when the user was created.
  updatedAt             DateTime          @updatedAt @map("updated_at") // Date and time when the user was last updated.
  annonymous            Boolean           @default(false) // Indicates whether the user is anonymous.
  charitiesFollowed     CharityFollower[] // List of charities followed by the user.
  charitiesOwned        CharityOwner[] // List of charities owned by the user.
  defaultCurrency       String            @default("GBP") @map("default_currency") // Default currency for the user.
  donations             Donation[] // List of donations made by the user.
  email                 String?           @unique // User's email address (unique).
  emailVerified         DateTime?         @map("email_verified") // Date and time when the user's email was verified (optional).
  firstName             String?           @map("first_name") // User's first name.
  fundraisers           Fundraiser[] // List of fundraisers owned by the user.
  image                 String? // URL to the user's profile image (optional).
  lastName              String?           @map("last_name") // User's last name.
  mfaSecret             String?           @map("mfa_secret") // Secret key for TOTP or mobile verification.
  mfaType               String?           @map("mfa_type") // MFA type chosen by the user ("TOTP" or "Mobile").
  password              String? // Hashed password for authentication. (optional)
  phoneNumber           String?           @unique @map("phone_number") // User's phone number (unique).
  phoneNumberVerified   DateTime?         @map("phone_number_verified") // Date and time when the user's phone number was verified (optional).
  savedFundraisers      SavedFundraiser[] // List of fundraisers saved by the user.
  totalCharitesOwned    Int               @default(0) @map("total_charities_owned") // Total number of charities owned by the user.
  totalDonationsAmount  Int               @default(0) @map("total_donations_amount") // Total amount donated by the user.
  totalDonationsMade    Int               @default(0) @map("total_donations_made") // Total number of donations made by the user.
  totalFundraisersOwned Int               @default(0) @map("total_fundraisers_owned") // Total number of fundraisers owned by the user.

  @@map("users")
}

model VerificationRequest {
  id         String   @id @default(cuid()) // Unique identifier for the verification request.
  createdAt  DateTime @default(now()) @map("created_at") // Date and time when the verification request was created.
  updatedAt  DateTime @updatedAt @map("updated_at") // Date and time when the verification request was last updated.
  expires    DateTime // Expiry date and time of the verification request.
  identifier String // Identifier for verification (e.g., email or username).
  token      String   @unique // Unique token for the verification request.

  @@unique([identifier, token]) // Ensure uniqueness of the combination of identifier and token.
  @@map("verification_requests")
}

// model Account {
//   id                 String    @id @default(cuid())
//   createdAt          DateTime  @default(now()) @map("created_at")
//   updatedAt          DateTime  @updatedAt @map("updated_at")
//   accessToken        String?   @map("access_token") // Access token for the account (optional).
//   accessTokenExpires DateTime? // Expiry date and time for the access token (optional).
//   providerAccountId  String    @map("provider_account_id") // Unique identifier for the account on the provider side.
//   providerId         String    @map("provider_id") // Identifier from the authentication provider.
//   providerType       String    @map("provider_type") // Type of authentication provider (e.g., "email", "google", etc.).
//   refreshToken       String?   @map("refresh_token") // Refresh token for the account (optional).
//   user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)
//   userId             String    @map("user_id") // Foreign key referencing the `id` field in the `User` model, indicating which user the account belongs to.

//   @@unique([providerId, providerAccountId])
//   @@map("accounts")
// }

// model Session {
//   id           String   @id @default(cuid())
//   createdAt    DateTime @default(now()) @map("created_at")
//   updatedAt    DateTime @updatedAt @map("updated_at")
//   accessToken  String   @unique // Unique access token for the session. 
//   expires      DateTime // Expiry date and time for the session.
//   sessionToken String   @unique @map("session_token") // Unique token for the session.
//   user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
//   userId       String   @map("user_id") // Foreign key referencing the `id` field in the `User` model, indicating which user the session belongs to.

//   @@map("sessions")
// }
